"use strict";$(function(){var l=new TmAlert(".main"),s={},t=function(a){$.get(window.tm.getAjaxUrl("/member/user/user-shop-info"),function(t){var n=t.code,i=t.msg,e=t.data;if(0===n){s.blueDiamond=e.blueDiamond,s.phone=e.phone,s.is_auth_id=e.is_auth_id,s.is_exchangeTime_q=e.is_exchangeTime_q,s.is_exchangeTime_e=e.is_exchangeTime_e,s.isPassword=e.is_trade_password_has,s.qGoods=e.qGoods||[],s.eGoods=e.eGoods||[],s.qq=e.qq;var o=etpl($("#tplUser").html());$("#J_user").html(o({data:{blueDiamond:window.tm.bitSeperator(e.blueDiamond),rmb:Math.floor(e.blueDiamond/1e4)}})),a&&a()}else window.tm.toast(i)},"json")},i=function(){var t={list:s.qGoods,phone:s.phone,qq:s.qq},n=etpl($("#tplQ").html())({data:t});$("#J_tabcontent").html(n)},e=function(){var t={list:s.eGoods,phone:s.phone},n=etpl($("#tplE").html())({data:t});$("#J_tabcontent").html(n)},u=function(){t(function(){!!$(".J_input-qq").length?i():e()})},o=function(){var d="active",c=!!$(".J_input-qq").length,t=c?'<div class="pwd-title">\n      <div>充值QQ号：<span>'.concat($(".J_input-qq").val(),"</span></div>\n      <div>兑换额度：<span>").concat($(".goods-li.".concat(d)).data("json").value," Q币</span></div>\n    </div>"):"";l.show({title:"请输入交易密码",content:'<div class="pwd">\n        '.concat(t,'\n        <div class="pwd-tip">请输入当前账号的交易密码</div>\n        <div class="pwd-box d-flex">\n          <input type="tel"/>\n          <div class="pwd-num ').concat(d,'"></div>\n          <div class="pwd-num"></div>\n          <div class="pwd-num"></div>\n          <div class="pwd-num"></div>\n          <div class="pwd-num"></div>\n          <div class="pwd-num"></div>\n        </div>\n        <div class="pwd-forget J_pwd-forget">忘记密码？</div>\n      </div>'),okBtn:!1,mainCSS:"width:5.9rem;top:2.5rem;transform: translate(-50%,0);"}),setTimeout(function(){$(".pwd input").on("focus",function(){var t=$(this)[0];t.setSelectionRange&&t.setSelectionRange(0,t.value.length)}),$(".pwd input")[0].focus(),$(".pwd input").on("keyup",function(t){var n=t.target.value.substring(0,6).replace(/[^\d]/g,"");$(this).val(n);var i,e,o=n.length;if($(".pwd-box .pwd-num").removeClass(d).html(""),$(".pwd-box .pwd-num").each(function(t){t<o?$(this).html('<div class="dot"></div>'):t===o&&$(this).addClass(d)}),6<=o){var a=(i=n.substring(0,6),(e=new JSEncrypt).setPublicKey("-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCFOYti3ibW46EXAKXeLNHeOE7t\nO6JHTQGRlt00nnF5gSPrMo75VGMJBIZ9yHPgJnK6TaMiKja7AhTH3g1rrIjfFBiL\n86Gy11e3AS7ZYC4cDt73Y7T73pRza6qLZOhoXadP0T1m/r4gE1yjkCF2CHlFr2b4\ncs70Ba1Gpcy+QdP9wQIDAQAB\n-----END PUBLIC KEY-----"),e.encrypt(i)),s={id:$(".goods-li.active").data("json").id,code:a};c&&(s.qq_num=$(".J_input-qq").val()),$(".pwd input").val(""),$.get(window.tm.getAjaxUrl("/member/user/user-shop-exchange"),s,function(t){var n=t.code,i=t.msg,e=t.data;0===n?(l.show({head:!1,content:'<div class="result">\n                <div class="result-title">兑换成功</div>\n                <div class="result-tip">请耐心等待审核</div>\n              </div>'}),u()):507===n?($(".pwd .pwd-tip").addClass("pwd-error").html("交易密码错误，还有".concat(e.num,"次机会")),$(".pwd-box .pwd-num").removeClass(d).html("").eq(0).addClass(d)):506===n?l.show({title:"交易密码已锁定",content:'<div style="font-size: 0.28rem;color: #414156;line-height:0.48rem;text-align: center;">交易密码已被锁定，<br>请10分钟后再试。</div>',cancelBtnText:"忘记密码",cancel:function(){window.tm.jump2app("36")},cancelBtn:!0,okBtnText:"我知道了"}):window.tm.toast(i)},"json")}})},0)};$(".main").on("click",".J_pwd-forget",function(){window.tm.jump2app("36")}),$("#J_tabcontent").on("click",".goods-li",function(){var t="active";$("#J_tabcontent .active").removeClass(t),$(this).addClass(t)}),$("#J_tabbar").on("click",".bar-q,.bar-e",function(){var t=$(this),n="active";t.hasClass(n)||($("#J_tabbar .active").removeClass(n),t.addClass(n),t.hasClass("bar-q")?i():e())}),$("#J_tabcontent").on("click",".J_goods-phone",function(){window.tm.jump2app("34")}),$("#J_tabcontent").on("click",".J_server",function(){window.tm.jump2app("37")}),$("#J_tabcontent").on("click",".J_goods-ok",function(){var t=!!$(".J_input-qq").length;if(t&&!$(".J_input-qq").val())return void window.tm.toast("请输入要充值的QQ号");if(0!==$(".goods-li.active").length)if(s.is_auth_id)if(s.isPassword)if(!t||s.is_exchangeTime_q)if(t||s.is_exchangeTime_e){var n=+$(".goods-li.active").data("json").blue;+s.blueDiamond<n?l.show({head:!1,content:'<div class="result result-fail">\n            <div class="result-title">兑换失败</div>\n            <div class="result-tip">当前账户蓝钻不足</div>\n          </div>'}):o()}else window.tm.toast("今日兑换京东E卡次数已用完，<br>请尝试其他兑换方式或明日再来吧");else window.tm.toast("今日兑换Q币次数已用完，<br>请尝试其他兑换方式或明日再来吧");else l.show({title:"交易密码设置提示",content:'<div style="font-size: 0.28rem;color: #414156;">兑换需要交易密码，<br>请先去设置吧～</div>',okBtnText:"去设置",ok:function(){window.tm.jump2app("36")}});else l.show({title:"兑换提示",content:"兑换需要认证身份信息，是否去认证",okBtnText:"去认证",ok:function(){window.tm.jump2app("35")}});else window.tm.toast("请选择要兑换的额度")}),$(".main").on("click","#J_gotoLog",function(){window.location.href="./log.html".concat(window.location.search)});var n,a;t(function(){i()}),n="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null,a=n.replace(/hidden/i,"visibilitychange"),document.addEventListener(a,function(){document[n]||u()})});